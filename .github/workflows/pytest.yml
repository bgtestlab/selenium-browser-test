name: pytest workflow

on:
  workflow_dispatch:

jobs:
  pytest:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Run pytest
      run: |
        docker-compose -f ./docker/docker-compose.yaml config
        docker-compose -f ./docker/docker-compose.yaml up \
        --abort-on-container-exit \
        --exit-code-from test-runner
        
    - name: Extract test results
      run: |
        docker ps -a
        docker cp test-runner:/app/output/* ./output
        ls ./output
